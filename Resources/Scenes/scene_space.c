  //////////////////////
 // Autor: Mabox1509 //
//////////////////////

#include "..\Sprites\Space.c"
#include <gb/gb.h>

//STRUCS
struct Astronaut
{
    unsigned char *x;
    unsigned char *y;
};




//VARIABLES
const unsigned char gui_map_rom[] = 
{
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,

    0x00, 0x08, 0x09, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x0A, 0x0B, 0x00, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

}; //Mapa de tiles


struct Astronaut astronaut;
unsigned long *score;
unsigned char *oxigen;

//METHODS

void UpdateAstronaut() //Actualizacion del obj Astronaut
{
    // Detección de teclas de dirección
    if (joypad() & J_LEFT)
    {
        --*(astronaut.x);

        set_sprite_tile(0,4); set_sprite_prop(0, S_FLIPX | 0);
        set_sprite_tile(1,3); set_sprite_prop(1, S_FLIPX | 0);
        set_sprite_tile(2,4); set_sprite_prop(2, S_FLIPX | S_FLIPY);
        set_sprite_tile(3,3); set_sprite_prop(3, S_FLIPX | S_FLIPY);
    }
    if (joypad() & J_RIGHT)
    {
        ++*(astronaut.x);

        set_sprite_tile(0,3); set_sprite_prop(0, 0 | 0);
        set_sprite_tile(1,4); set_sprite_prop(1, 0 | 0);
        set_sprite_tile(2,3); set_sprite_prop(2, 0 | S_FLIPY);
        set_sprite_tile(3,4); set_sprite_prop(3, 0 | S_FLIPY);
    }

    if (joypad() & J_UP)
    {
        --*(astronaut.y);

        set_sprite_tile(0,1); set_sprite_prop(0, 0 | 0);
        set_sprite_tile(1,1); set_sprite_prop(1, S_FLIPX | 0);
        set_sprite_tile(2,2); set_sprite_prop(2, 0 | 0);
        set_sprite_tile(3,2); set_sprite_prop(3, S_FLIPX | 0);
    }
    else if (joypad() & J_DOWN)
    {
        ++*(astronaut.y);

        set_sprite_tile(0,2); set_sprite_prop(0, 0 | S_FLIPY);
        set_sprite_tile(1,2); set_sprite_prop(1, S_FLIPX | S_FLIPY);
        set_sprite_tile(2,1); set_sprite_prop(2, 0 | S_FLIPY);
        set_sprite_tile(3,1); set_sprite_prop(3, S_FLIPX | S_FLIPY);
    }

    /*
            ^
            |
            |
            |
    Codigo terrible XD
    
    */

    move_sprite(0, *astronaut.x - 8, *astronaut.y - 8);
    move_sprite(1, *astronaut.x, *astronaut.y - 8);
    move_sprite(2, *astronaut.x - 8, *astronaut.y);
    move_sprite(3, *astronaut.x, *astronaut.y);
}


//SCENE
void SceneSpace_Init(unsigned char *ram,unsigned char *tiles) //Scena cargada
{
    score = (unsigned long *)&ram[0];
    oxigen = (unsigned char *)&ram[8];
    astronaut.x = (unsigned char *)&ram[9];
    astronaut.y = (unsigned char *)&ram[10];

    *astronaut.x = 60;
    *astronaut.y = 70;

    *oxigen = 100;
    *score = 123456789;
    
    
    //SET TILES
    set_bkg_tiles(0, 0, 20, 18, gui_map_rom); //Establecer los tiles de fondo
    //UpdateScore(tiles);

    set_sprite_data(1,10,SpaceGrid); //Cargar 10 tiles del array SpaceGrid en vram desde el index 1 
    
    //Set player sprites
    set_sprite_tile(0,1); set_sprite_prop(0, 0 | 0); //Posicionando y flipeando los sprites del jugador
    set_sprite_tile(1,1); set_sprite_prop(1, S_FLIPX | 0);
    set_sprite_tile(2,2); set_sprite_prop(2, 0 | 0);
    set_sprite_tile(3,2); set_sprite_prop(3, S_FLIPX | 0);
}
void SceneSpace_Update(unsigned char *tiles) //Gameloop
{
    UpdateAstronaut();
}

